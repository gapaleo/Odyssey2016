<%= render 'layouts/navbar' %>

   <div class="container">
        <div class="row">
            <div class="col-md-8 col-md-offset-2 col-xs-12 well extra-spacing">
                <div class="row">
                    <div class='col-md-8 col-md-offset-2 col-sm-6 col-sm-offset-3 col-xs-8 col-xs-offset-2'>
                        <h2>Truck Reports</h2>
                        <p>Select a pickup date below to export the daily truck report and MapQuest route information.</p>
                        <p>
                        The truck report is saved as file truck_[DATE].pdf <br>
                        The mapquest report is saved as file mapquest_[DATE].csv
                        </p>
                        <br>
                    </div>
                </div>
                <div class="row">
                    <div class='col-md-8 col-md-offset-2 col-sm-6 col-sm-offset-3 col-xs-8 col-xs-offset-2'>
                        <form>
                            <div class="form-group">
                                Pickup Day:
                                <%= select_tag 'pickupday', options_for_select(@days.collect{|d| 
                                  [d.date.strftime("%b %-d"), d.date]}),
                                  class: "form-control" %>   
                            </div>
                            <br>
                            <div class="form-group">

                              <!--Export and cancel buttons-->
                                <div class="col-xs-12 text-center">
                              <%=button_tag 'Export', type: 'button', id: 'exportButton', class: 'btn btn-success btn-wide'%>
                              <%= link_to 'Cancel', '/reports', class: 'btn btn-danger btn-wide'%>  
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

        </div>
    </div>

<!--In order to have the ability to download multiple files with a single request/click -->
<!--of a button, I attached a javascript function to the export button. The alternative -->
<!--is to bundle the two files together into a zipped folder. -->
<script>
var submitButton = document.getElementById("exportButton");
var select = document.getElementById("pickupday");

// Attaches an onClick listener to the export button 
submitButton.addEventListener("click", exportFiles);    

//This function is called everytime the user clicks the export button
function exportFiles()
{
  //Used iframes to be able to download multiple files

    // var iframe1 = document.createElement('iframe');
    
    // //Url is built using the selected value in the dropdown menu
    // url = "/reports/truck.pdf?pickupday=" + select.value;
    // iframe1.style.display = "none";
    // iframe1.src = url ;
    // document.body.appendChild(iframe1);
  
    // var iframe2 = document.createElement('iframe');
    
    // //Url is build using the selected value in the dropdown menu
    // url = "/reports/truck.csv?pickupday=" + select.value;
    // iframe2.style.display = "none";
    // iframe2.src = url ;
    // document.body.appendChild(iframe2);

    url1 = "/reports/truck.pdf?pickupday=" + select.value;
    url2 = "/reports/truck.csv?pickupday=" + select.value;
    createiframe(url1);
    window.setTimeout(function() {createiframe(url2)}, 500);
}

function createiframe(url){
    var iframe1 = document.createElement('iframe');
    iframe1.style.display = "none";
    iframe1.src = url ;
    document.body.appendChild(iframe1);
}
</script>
